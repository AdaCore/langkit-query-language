selector supertypes
    | TypeDecl          => skip it.type_def
    | InterfaceTypeDef  => skip it.interfaces
    | RecordTypeDef     => ()
    | DerivedTypeDef    => skip it.subtype_indication <> skip it.interfaces
    | SubtypeIndication => skip it.name
    | Name              => rec it.referenced_decl(true)
    | ParentList        => skip *it.children
    | _                 => ()

let result: List = query TypeDecl(any supertypes(depth=3): _)

print(result)